# ðŸ§© cyano_annotation Tool Integration Manual

## Overview

The **cyano_annotation** code was developed in such a way that additional tools can be integrated with minimal effort, without affecting the general structure of the package.

The source code (`src`) consists of five main files:
- **analysis/**
- **converters/**
- **parsers/**
- **visualisation/**
- **cli/**

Each of these contains scripts serving their respective purposes.

---

## Example Integration of a Chosen Tool

After choosing the tool you want to integrate, the **outputs of the tool** must be defined.

### Step 1: Define and Parse the Tool Output

The first step of integration is selecting the **tool output format** you want to use.  
For example, if the tool uses the `.tsv` format as output:

A `parser.py` script must be written containing all the necessary functions to convert the `.tsv` format into data that can be integrated into the **enhanced.gbff/gff** files generated by the package.

We primarily use **dictionaries** and **dataframes** to isolate information from tool outputs, as they provide an easy way to:
- Select only the desired information
- Exclude any unnecessary data

#### Example: InterProScan Integration

In the case of *InterProScan*, the function `ipr_terminder` was developed to isolate all key elements of the `.gff3` output.

A dictionary was created with the `"locus_tag"` as the **key**, and complementary lists were generated for each desired entry in the *attributes* column (e.g., `GO:`, `InterPro:`, `Description`, etc.).  
This allows selective parsing of only the needed information rather than the entire tool output.

Afterward, a function called `ipr_dictotsv` was developed to convert the dictionary into a `.tsv` file containing all the **ipr_hits**.

---

### Step 2: Integrate Parsed Data into the Final Output

The second step is to **integrate the formatted output** into the final `enhanced.gbff` or `gff` file using the scripts contained in the **"converters"** directory.

#### ðŸ”§ Example: InterProScan Integration

For InterProScan, the function `merge_csv_to_gbff` (from the script `merge_gbff`) was used to integrate the `ipr_hits` data into the final GBFF output.  
This GBFF is later converted into GFF format.

A snippet was added inside the function that uses the dictionary key (`locus_tag`) to match each entry with the corresponding sequence in the GBFF.  
Using Biopythonâ€™s `Bio.SeqIO`, the different features of the GBFF file (e.g., `product`, `gene`, `id`, `dbxref`, etc.) were located, and the information from *ipr_hits* was appended to the feature of choice. Additional filtering options can be added here for the information that is to be included in the GBFF

> **Note:**  
> The function input must be adjusted to receive the tool output file:
> ```python
> merge_csv_to_gbff(+parsed_tool_file)
> ```

---

### Step 3: Update the CLI (Command Line Interface)

In the final step, the **annotate** script inside the **"cli"** directory must be edited to include the new toolâ€™s output.

Using **Typer**, a small code snippet should be added for the `-input` option as well as for the function `merge_csv_to_gbff`, so that the tool output is included in the workflow.

---

## Additional Example: antiSMASH Integration

In the case of **antiSMASH**, a parser script was created to extract all required information.  
Then, a snippet was added in the `gbff_to_gff` function (inside the **"converters"** file) to directly integrate this information into the final GFF file â€” as a **separate section** from the GBFF annotation information.

---

## âœ… Summary of Integration Steps

To integrate a new tool into **cyano_annotation**, follow these simple steps:

1. **Create a parser script**  
   Filters the tool output and converts it into data that can be integrated into the final GBFF or GFF file.

2. **Integrate the formatted output**  
   Use one of the provided merger scripts (e.g., `merge_gbff` or `gbff_to_gff`) to merge the processed data.

3. **Update the CLI**  
   Include the toolâ€™s initial output file in the Typer argument section and in the corresponding workflow function.

---



